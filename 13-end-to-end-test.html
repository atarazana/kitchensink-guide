<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>End To End Test :: Kitchensink Guide</title>
    <link rel="canonical" href="https://atarazana.github.io/kitchensink-guide/13-end-to-end-test.html">
    <link rel="prev" href="12-test-cicd-pipelines.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="./_/css/site.css">
<link rel="icon" href="./_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img
          src="./_/img/header_logo.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" href="https://atarazana.github.io/kitchensink-guide">Kitchensink Guide</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Books</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">CheatSheets</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">CheatSheet A</a>
            <a class="navbar-item" href="#">CheatSheet B</a>
            <a class="navbar-item" href="#">CheatSheet C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Upcoming Events</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Event A</a>
            <a class="navbar-item" href="#">Event B</a>
            <a class="navbar-item" href="#">Event C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Tutorial A</a>
            <a class="navbar-item" href="#">Tutorial B</a>
            <a class="navbar-item" href="#">Tutorial C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ROOT" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html" class=" query-params-link">Kitchensink Guide</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="01-setup.html">1. Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#openshift">Setup OpenShift 4</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#download-tutorial">Get tutorial sources</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-prepare-cluster.html">2. Prepare Cluster</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-prepare-cluster.html#deploying-core-components">Deploying core components</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-prepare-cluster.html#high-level-tests">High Level Tests</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-prepare-cluster.html#checking-quay">Checking Quay</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-prepare-cluster.html#deploying-gitea">Deploying Gitea</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-prepare-repositories.html">3. Prepare Repositories</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-prepare-repositories.html#source-of-truth">Source Of Truth</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-prepare-repositories.html#explore-gitea-console">Explore Gitea console</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-prepare-repositories.html#create-git-pat">Create Git PAT</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-prepare-repositories.html#migrate-repositories">Migrate Repositories</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="04-s2i.html">4. Deploy JBoss EAP Application with S2I</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-s2i.html#overview">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-s2i.html#deploy">Deploying a JBOSS EAP 7.2 application manually</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-s2i.html#redeploy">Redeploying a JBOSS EAP application</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="05-argo.html">5. Deploy JBoss EAP Application with ArgoCD</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05-argo.html#overview">Simplification, git-based automation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05-argo.html#deploy">Deploy Kitchensink app with ArgoCD</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="06-applicationset.html">6. ArgoCD + ApplicationSet</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="06-applicationset.html#overview">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="06-applicationset.html#deploy">Deploy Kitchensink app with ArgoCD + ApplicationSet</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="07-kustomize.html">7. ArgoCD + Kustomize</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="08-helm.html">8. ArgoCD + Helm</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="09-cicd.html">9. CI/CD Pipelines</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="10-helm-kustomized.html">10. ArgoCD + Helm + Kustomize</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="10-helm-kustomized.html#overview">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="10-helm-kustomized.html#deploy">Deploy Kitchensink app with ArgoCD + Kustomize + Helm</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="10-helm-kustomized.html#benefits">Benefits of the GitOps/ArgoCD model</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="11-pipeline-webhooks.html">11. Pipeline Webhooks</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="12-test-cicd-pipelines.html">12. Check Pipeline Webhooks</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="12-test-cicd-pipelines.html#check-kitchensink-ci-web-hook">Check Kitchensink CI Web Hook</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="12-test-cicd-pipelines.html#check-kitchensink-cd-web-hook">Check Kitchensink CD Web Hook</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="13-end-to-end-test.html">13. End to End Test</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#introduction">Introduction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#current-status">Ⓐ Current Status</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#change-the-code">Ⓑ Change the code</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#run-ci-pipeline">Ⓒ Run CI pipeline</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#running-cd-pipeline-dev">Ⓓ Run CD pipeline (<code>dev</code>)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#running-cd-pipeline-test">Ⓔ Run CD pipeline (<code>test</code>)</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Kitchensink Guide</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Kitchensink Guide</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Kitchensink Guide</a></li>
    <li><a href="13-end-to-end-test.html">13. End to End Test</a></li>
  </ul>
</nav>
  <div style="padding: 0 0.5rem 0 0.75rem;"><a href="https://github.com/atarazana" target="_blank" rel="noopener noreferrer"> © 2023 - Atarazana</a></div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">End To End Test</h1>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>So far, <strong>you have deployed your application and CICD pipelines</strong>; additionally you <strong>have created webhooks</strong> and they are, apparently, working properly but we will never know for sure unless we make a change in the code and see if it all works as expected and we see that change being promoted through our environments. <strong>It&#8217;s about time for an end to end test!</strong></p>
</div>
<div class="paragraph">
<p>The next diagram summarizes the end to end test you are going to run. As you can see, you will make a change to the code in the <em>Kitchensink API</em> (<strong>kitchensink</strong>) which, via a webhook, will trigger the CI pipeline and hence the promotion of code.</p>
</div>
<div class="imageblock unresolved">
<div class="content">
<img src="end-to-end-pipeline-1.png" alt="End to End Pipeline Test">
</div>
</div>
<div class="paragraph">
<p>These are the high level sequence of events (only relevant steps are mentioned, more details later on):</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Change the code and push those changes to the repository of code (<strong>kitchensink</strong> in this case).</p>
</li>
<li>
<p>The <strong><em>Push Event</em></strong> is sent by the webhook to the <strong>kitchensink CI Pipeline Event Listener</strong> which in its turn triggers the pipeline by creating a <strong><em>PipelineRun</em></strong> object.</p>
</li>
<li>
<p>The <code>build</code> step builds the image for <strong>kitchensink</strong> and pushes it to the registry, the hash of the new image is used to update the <em>kustomization.yaml</em> file in the <em>dev overlay</em>, in a short-lived feature-branch in the configuration repository (<strong>kitchensink-conf</strong>)</p>
</li>
<li>
<p>A <strong><em>Pull Request</em></strong> is created for <strong>merging</strong> the <code>feature branch</code> with the <code>main branch</code> in the <code>pr-create</code> step.</p>
</li>
<li>
<p>The PR has to be confirmed so that changes are effectively merged into the main branch (this is a manual step)</p>
</li>
<li>
<p>Once the PR is confirmed, the merge is effective and a <strong><em>Pull Request Event</em></strong> is sent by the corresponding webhook to the <strong>kitchensink CD Pipeline Event Listener</strong> which in its turn triggers the pipeline by creating another <strong><em>PipelineRun</em></strong> object. At this point the hash of the new image has replaced the previous one.</p>
</li>
<li>
<p>The <em>CD pipeline fetches configuration not code</em> and <em>in parallel triggers the sync of</em> <strong>kitchensink-kustomized-helm-app-dev</strong> which means the new hash of the image is replaced in the Deployment object and hence a rolling update is triggered. Once the app is in sync a new PR is created to promote the code to the next environment.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Steps 6 and 7 are repeated for each environment until the code has been promoted to all of them.</p>
</div>
<div class="paragraph">
<p>Ok, done with the introduction, let&#8217;s get down to work!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="current-status"><a class="anchor" href="#current-status"></a>Ⓐ Current Status</h2>
<div class="sectionbody">
<div class="paragraph">
<p><mark>TODO</mark></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="change-the-code"><a class="anchor" href="#change-the-code"></a>Ⓑ Change the code</h2>
<div class="sectionbody">
<div class="paragraph">
<p><mark>TODO</mark></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="run-ci-pipeline"><a class="anchor" href="#run-ci-pipeline"></a>Ⓒ Run the CI pipeline</h2>
<div class="sectionbody">
<div class="paragraph">
<p><mark>TODO</mark></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-cd-pipeline-dev"><a class="anchor" href="#running-cd-pipeline-dev"></a>Ⓓ Run the CD pipeline (<code>dev</code>)</h2>
<div class="sectionbody">
<div class="paragraph">
<p><mark>TODO</mark></p>
</div>
<div class="sect2">
<h3 id="approving-pr-dev"><a class="anchor" href="#approving-pr-dev"></a>Approve PR</h3>
<div class="paragraph">
<p>Well, it&#8217;s time to continue where we left it, so go back to the PR and click on the <code>Create Merge Commit</code> then tick the <code>Delete Branch</code> check-box (we wont need that branch anymore) and click again on <code>Create Merge Commit</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="cd-pipeline-triggered-dev"><a class="anchor" href="#cd-pipeline-triggered-dev"></a>CD Pipeline Triggered</h3>
<div class="paragraph">
<p>The <strong>Pull Request</strong> event is sent out by the webhook to the <strong>Kitchensink CD Pipeline <code>EventListener</code></strong> where some mapping and filtering will trigger the pipeline with a <code>PipelineRun</code> object populated with the necessary information.</p>
</div>
<div class="paragraph">
<p>Please, open the next link or navigate to <strong>Pipelines</strong> in project <code>kitchensink-cicd-%USERNAME%</code> you will see the pipeline progressing.</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">https://console-openshift-console.apps.%BASE_SUBDOMAIN%/dev-pipelines/ns/kitchensink-cicd-%USERNAME%</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As you have done previously you can click on the <strong>PLR</strong> object to drill down and have a look to the logs.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><mark>IMAGE TODO</mark></p>
</div>
<div class="paragraph">
<p>Have a look at the pipeline details. As you can see there are several tasks, namely:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>argocd-sync</code> triggers the refresh and sync of descriptors coming from the corresponding overlay<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>, <code>dev</code> in this case</p>
</li>
<li>
<p><code>fetch-config-repository</code> clones the <code>kitchensink-conf</code> configuration repository</p>
</li>
<li>
<p><code>update-image</code> creates a short-lived branch and updates the image hash in the <code>kustomization.yaml</code> file for the corresponding overlay</p>
</li>
<li>
<p><code>github-pr-create</code> creates a PR for Github (not run)</p>
</li>
<li>
<p><code>gitea-pr-create</code> creates a PR for Gitea</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><mark>IMAGE TODO</mark></p>
</div>
</div>
<div class="sect2">
<h3 id="argocd-app-synced-dev"><a class="anchor" href="#argocd-app-synced-dev"></a>ArgoCD App Synced</h3>
<div class="paragraph">
<p><mark>TODO</mark></p>
</div>
</div>
<div class="sect2">
<h3 id="checking-openshift-console-dev"><a class="anchor" href="#checking-openshift-console-dev"></a>Checking OpenShift Console</h3>
<div class="paragraph">
<p><mark>TODO</mark></p>
</div>
</div>
<div class="sect2">
<h3 id="checking-kitchensink-status-dev"><a class="anchor" href="#checking-kitchensink-status-dev"></a>Checking Kitchensink Status</h3>
<div class="paragraph">
<p><mark>TODO</mark></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-cd-pipeline-test"><a class="anchor" href="#running-cd-pipeline-test"></a>Ⓔ Run the CD pipeline (<code>test</code>)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This time we&#8217;re going to do this a bit faster and with less talking. This chapter is essentially the same as the previous one, but if you have access to an additional cluster and you have run section <a href="#04-prepare-argocd.adoc#register-additional-clusters" class="xref unresolved">Register Additional Clusters</a>, then you will see how <strong>Kitchensink</strong> is also updated in the additional cluster.</p>
</div>
<div class="sect2">
<h3 id="approving-pr-test"><a class="anchor" href="#approving-pr-test"></a>Approve PR</h3>
<div class="paragraph">
<p><mark>TODO</mark></p>
</div>
</div>
<div class="sect2">
<h3 id="cd-pipeline-triggered-test"><a class="anchor" href="#cd-pipeline-triggered-test"></a>CD Pipeline Triggered</h3>
<div class="paragraph">
<p><mark>TODO</mark></p>
</div>
</div>
<div class="sect2">
<h3 id="argocd-app-synced-test"><a class="anchor" href="#argocd-app-synced-test"></a>ArgoCD App Synced</h3>
<div class="paragraph">
<p><mark>TODO</mark></p>
</div>
</div>
<div class="sect2">
<h3 id="checking-openshift-console-test"><a class="anchor" href="#checking-openshift-console-test"></a>Checking OpenShift Console</h3>
<div class="paragraph">
<p><mark>TODO</mark></p>
</div>
</div>
<div class="sect2">
<h3 id="checking-kitchensink-status-test"><a class="anchor" href="#checking-kitchensink-status-test"></a>Checking Kitchensink Status</h3>
<div class="paragraph">
<p><mark>TODO</mark></p>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. <a href="https://kubernetes.io/docs/tasks/manage-kubernetes-objects/kustomization/#bases-and-overlays" class="bare">https://kubernetes.io/docs/tasks/manage-kubernetes-objects/kustomization/#bases-and-overlays</a>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="12-test-cicd-pipelines.html" class="query-params-link">12. Check Pipeline Webhooks</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="./_/js/vendor/clipboard.js"></script>
<script src="./_/js/site.js"></script>
<script async src="./_/js/vendor/highlight.js"></script>
  </body>
</html>
